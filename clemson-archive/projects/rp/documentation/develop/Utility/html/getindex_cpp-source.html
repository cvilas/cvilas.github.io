<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>getindex.cpp Source File</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Wed Jul 2 17:02:28 2003 -->
<h1>getindex.cpp</h1><div class="fragment"><pre>00001   
00002 
00003 <font class="preprocessor">#include &lt;iostream.h&gt;</font>
00004 
00005 
00006 <font class="preprocessor">#include "RoboticPlatform.hpp"</font>
00007 <font class="preprocessor">#include "ObjectManager.hpp"</font>
00008 <font class="preprocessor">#include "Puma560.hpp"</font>
00009 <font class="preprocessor">#include "Puma560Model.hpp"</font>
00010 <font class="preprocessor">#include "DefaultTrajectoryGenerator.hpp"</font>
00011 <font class="preprocessor">#include "Vector.hpp"</font>
00012 
00013 
00014 
00015 <font class="keyword">class </font>GetIndex : <font class="keyword">public</font> Puma560
00016 {
00017   <font class="keyword">protected</font>:
00018     <font class="keyword">typedef</font> Puma560 Parent;
00019 
00020   <font class="keyword">public</font>:
00021 
00022   
00023     GetIndex();
00024             
00025     GetIndex (<font class="keyword">const</font> <font class="keywordtype">char</font> *objectName);
00026             
00027     ~GetIndex();
00028         
00029 
00030       
00031     Vector&lt;6, int&gt; getFirstIndexPosition();
00032         
00033       
00034     <font class="keyword">virtual</font> <font class="keywordtype">int</font> control();
00035         
00036     <font class="keyword">virtual</font> <font class="keywordtype">int</font> startControl();
00037             
00038       
00039     <font class="keyword">private</font>:
00040         Vector&lt;6, int&gt; d_encoderFirstIndex;
00041                   
00042         Vector&lt;6, int&gt; d_indexFound;
00043       
00044 };
00045 
00046 
00047 
00048 GetIndex::GetIndex()
00049 : Puma560()
00050 {
00051     d_indexFound = 0;
00052     d_encoderFirstIndex = 0;
00053 }
00054 
00055 
00056 GetIndex::GetIndex (<font class="keyword">const</font> <font class="keywordtype">char</font> *objectName)
00057     : Puma560()
00058 {
00059     d_indexFound = 0;
00060     d_encoderFirstIndex = 0;
00061 
00062     init(objectName);
00063 }
00064 
00065   
00066 GetIndex::~GetIndex ()<font class="keyword"></font>
00067 <font class="keyword"></font>{
00068     exit();
00069 }
00070 
00071 
00072 
00073 <font class="keywordtype">int</font> GetIndex::startControl()<font class="keyword"></font>
00074 <font class="keyword"></font>{
00075     Puma560::startControl();
00076     d_indexFound = 0;
00077     
00078 }
00079 
00080 
00081 <font class="keywordtype">int</font> GetIndex::control()<font class="keyword"></font>
00082 <font class="keyword"></font>{
00083     Puma560::control();
00084     
00085     <font class="keywordtype">int</font> encoderIndexValue;
00086     
00087     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> joint = 1; joint &lt;=6; joint++)
00088     {
00089         <font class="keywordflow">if</font> (d_ioBoardClient)
00090         {
00091             <font class="keywordflow">if</font>( isIndexPulse(joint) &amp;&amp; d_indexFound(joint) == 0 )
00092             {
00093                 <font class="keywordflow">if</font> ( d_useDigitalInputsForIndexPulses )
00094                     encoderIndexValue = d_ioBoardClient-&gt;getEncoderValue
00095                                                                             (d_encoderStartChannel + joint - 1);
00096                 <font class="keywordflow">else</font>
00097                     encoderIndexValue = d_ioBoardClient-&gt;getEncoderIndexValue(joint - 1);
00098                     
00099                 d_encoderFirstIndex(joint) = encoderIndexValue;
00100                 d_indexFound(joint) = 1;
00101             }
00102         }
00103     }
00104     <font class="keywordflow">return</font> 0;
00105 }
00106 
00107 
00108 Vector&lt;6, int&gt; GetIndex::getFirstIndexPosition()<font class="keyword"></font>
00109 <font class="keyword"></font>{
00110     <font class="keywordflow">return</font> d_encoderFirstIndex;
00111 }
00112 
00113 
00114 
00115 <font class="keywordtype">int</font> main (<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[])<font class="keyword"></font>
00116 <font class="keyword"></font>{
00117     OpenArchitectureManipulator::setAutoEnableArmPowerOff();
00118     
00119     RoboticPlatform::init(argc, argv);
00120     <font class="keywordflow">if</font> (RoboticPlatform::d_status.isStatusError())
00121     {
00122         cout &lt;&lt; RoboticPlatform::d_status.getMessageText() &lt;&lt; endl;
00123         RoboticPlatform::d_status.setStatusOk();
00124         <font class="keywordflow">return</font> -1;
00125     }
00126 
00127     
00128     FILE *outfile;    <font class="comment">// This file holds the calibration results.</font>
00129         
00130         outfile = fopen(<font class="stringliteral">"encoderFirstIndex.txt"</font>, <font class="stringliteral">"w+"</font>);
00131 
00132 
00133     Vector&lt;6&gt; initialPosition;
00134     Vector&lt;6&gt;   range;
00135     Vector&lt;6, int&gt; encoderAtIndex;
00136     Vector&lt;6&gt; endPosition;
00137 
00138     GetIndex puma; <font class="comment">// Puma object.</font>
00139     puma.setSimulationModeOff();
00140 
00141     
00142     initialPosition = 0, 90, -90, 0, 0, 0;
00143     range = 10, 10, 10, 10, 10, 10;
00144     
00145     initialPosition = initialPosition * M_PI/180;
00146     range = range * M_PI/180;
00147     
00148     endPosition = initialPosition + range;
00149     
00150       DefaultTrajectoryGenerator  &lt;6&gt; tragen;
00151     tragen.setSpeedScale(0.1);
00152     tragen.setBlockingMovesOff();
00153     puma.setTrajectoryGenerator(tragen);
00154     
00155 
00156     <font class="keywordflow">if</font> ( puma.isSimulationModeOn() )
00157     {
00158         cout &lt;&lt; endl &lt;&lt; <font class="stringliteral">"*** WARNING : SIMULATION MODE - Index positions cannot be obtained in simulation mode ***"</font> 
00159                  &lt;&lt; endl;
00160                  
00161     }
00162 
00163     puma.calibrateJointPosition(initialPosition);
00164     puma.enableArmPower();
00165     
00166     tragen.setSpeedScale(0.01);
00167     tragen.move(endPosition);
00168     tragen.stop(0.5);
00169     tragen.waitForLastRequestCompleted();
00170         
00171     tragen.setSpeedScale(1);
00172     tragen.move(initialPosition);
00173     tragen.stop(0.5);
00174     tragen.waitForLastRequestCompleted();
00175 
00176     puma.disableArmPower();
00177     
00178         
00179       encoderAtIndex = puma.getFirstIndexPosition();
00180     cout &lt;&lt; <font class="stringliteral">"First encoder index position : "</font> &lt;&lt; transpose(encoderAtIndex) &lt;&lt; endl;
00181     
00182 
00183       fprintf (outfile, <font class="stringliteral">"%s %d %d %d %d %d %d\n"</font>, 
00184                         <font class="stringliteral">"d_encoderAtIndex"</font>, encoderAtIndex(1), encoderAtIndex(2), encoderAtIndex(3),
00185                         encoderAtIndex(4), encoderAtIndex(5), encoderAtIndex(6) );
00186     fclose(outfile);
00187 
00188     
00189     RoboticPlatform::exit();
00190     <font class="keywordflow">return</font> 0;
00191 }
00192 
</div></pre></body>
</html>
