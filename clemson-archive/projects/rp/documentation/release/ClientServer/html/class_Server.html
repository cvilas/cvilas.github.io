<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Server Class Reference</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Mon Apr 30 11:57:54 2001 -->
<h1>Server  Class Reference</h1>Message passing server. 
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="Server_hpp-source.html">Server.hpp</a>&gt;</code>
<p>
<a href="class_Server-members.html">List of all members.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Public Methods</h2></td></tr>
<tr><td nowrap align=right valign=top>&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a0">Server</a> (const char *serverName = 0, int maxMessageSize = 1024)</td></tr>
<tr><td nowrap align=right valign=top>virtual&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a1">~Server</a> ()</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a2">attachServerName</a> (const char *serverName)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a3">detachServerName</a> ()</td></tr>
<tr><td nowrap align=right valign=top>const char*&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a4">getServerName</a> () const</td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a5">doMessageLoop</a> ()</td></tr>
<tr><td nowrap align=right valign=top>virtual int&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a6">serveMessage</a> (pid_t pid, void *messageBuffer)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a7">replyMessage</a> (const void *reply, int replySize)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a8">replyMessage</a> ()</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a9">replyMessage</a> (int iReply)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a10">replyMessage</a> (Status &amp;status)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a11">receiveMessage</a> (void *msg, int msgSize)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a12">receiveMessage</a> ()</td></tr>
<tr><td nowrap align=right valign=top>pid_t&nbsp;</td><td valign=bottom><a class="el" href="class_Server.html#a13">receiveMessageFromAnybody</a> (void *message, int messageSize)</td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Message passing server.
<p>
The class Server is responsible for the server side of a client/server relationship. In a client server relationship, a program is designated the server. The server registers itself under a unique server name and waits for messages. The client finds the server by its name, connects to it, and sends messages to the server. The server receives messages, processes them and sends a reply back to the client.
<p>
The class Server provides a platform-independent wrapper for server functionality. It provides functionality to register itself in global namespace, to receive messages, and reply to messages.
<p>
<b>Example Programs:</b>
<p>
<div class="fragment"><pre><font class="comment">//========================================================================</font>
<font class="comment">// Project: QRTS Utility Libraries</font>
<font class="comment">// ----------------------------------------------------------------------</font>
<font class="comment">// Package: Client/Server</font>
<font class="comment">// Authors: Markus Loffler</font>
<font class="comment">// ----------------------------------------------------------------------</font>
<font class="comment">// File: Server.t.cpp</font>
<font class="comment">// Example for the server class.</font>
<font class="comment">//========================================================================</font>

<font class="preprocessor">#include &lt;iostream.h&gt;</font>
<font class="preprocessor">#include "Server.hpp"</font>


<font class="keyword">class </font>MyServer : <font class="keyword">public</font> <a class="code" href="class_Server.html">Server</a>
{
 <font class="keyword">public</font>:
  MyServer();
  
 <font class="keyword">protected</font>:
  <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_Server.html#a6">serveMessage</a>(pid_t clientPid, <font class="keywordtype">void</font> *message);
};

MyServer::MyServer() : <a class="code" href="class_Server.html">Server</a>("qrts/testserver")
{
}

<font class="keywordtype">int</font> <a class="code" href="class_Server.html#a6">MyServer::serveMessage</a>(pid_t clientPid, <font class="keywordtype">void</font> *message)<font class="keyword"></font>
<font class="keyword"></font>{
  clientPid = clientPid;
  
  <font class="keywordtype">int</font> msg = * (<font class="keywordtype">int</font> *) message;
  Status status;
  cout &lt;&lt; <font class="stringliteral">"Message "</font> &lt;&lt; msg &lt;&lt; <font class="stringliteral">" received"</font> &lt;&lt; endl;
  
  <font class="keywordflow">switch</font> (msg)
  {
    <font class="keywordflow">case</font> 0:
      <a class="code" href="class_Server.html#a8">replyMessage</a>();
      <font class="keywordflow">return</font> -1;
      
    <font class="keywordflow">case</font> 1: 
      status.setStatusError(-33)
        &lt;&lt; <font class="stringliteral">"An error occurred"</font> &lt;&lt; endl;
      <a class="code" href="class_Server.html#a8">replyMessage</a>(status);
      <font class="keywordflow">return</font> 0;
      
    <font class="keywordflow">case</font> 2: 
      <a class="code" href="class_Server.html#a8">replyMessage</a>(status);
      <font class="keywordflow">return</font> 0;
      
    <font class="keywordflow">case</font> 10: 
      <a class="code" href="class_Server.html#a8">replyMessage</a>(status);
      <font class="keywordtype">char</font> text[100];
      <a class="code" href="class_Server.html#a12">receiveMessage</a>(text, <font class="keyword">sizeof</font>(text));
      <a class="code" href="class_Server.html#a8">replyMessage</a>(status);
      cout &lt;&lt; <font class="stringliteral">"String message: "</font> &lt;&lt; (<font class="keywordtype">char</font> *) text &lt;&lt; endl;
      <font class="keywordflow">return</font> 0;
      
    <font class="keywordflow">default</font>:
      cout &lt;&lt; <font class="stringliteral">"Unknown message"</font> &lt;&lt; endl;
      <font class="keywordflow">return</font> 0;
  }
}

<font class="keywordtype">int</font> main()<font class="keyword"></font>
<font class="keyword"></font>{
  cout &lt;&lt; <font class="stringliteral">"Server..."</font> &lt;&lt; endl;
  MyServer server;
  server.<a class="code" href="class_Server.html#a5">doMessageLoop</a>();
  
  <font class="keywordflow">return</font> 0;
}
</div></pre> 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a name="a0" doxytag="Server::Server"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
Server (
          </b></td>
          <td valign="bottom"><b>
const char * <em>serverName</em> = 0, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
int <em>maxMessageSize</em> = 1024&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Constructor. The server is registered under the given name. If no server name is given, no name is attached. The name can be attached later by calling attachServerName.
<p>
In QNX6, if no server name is specified, the server can be used for message passing within the same process, but different threads. Create the server in one thread first using this constructor with no server name specified, and then create the client and pass the server object to the <a class="el" href="class_Client.html">Client</a> constructor. <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>serverName</em>
&nbsp;</td><td>
 Name under which the server should be registered </td></tr>
<tr><td valign=top><em>maxMessageSize</em>
&nbsp;</td><td>
 Maximum size of a message that is being received (i.e., the receive buffer size) </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<a name="a1" doxytag="Server::~Server"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
~Server (
          </b></td>
          <td valign="bottom"><b>
)<code> [virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Destructor     </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a name="a2" doxytag="Server::attachServerName"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void attachServerName (
          </b></td>
          <td valign="bottom"><b>
const char * <em>serverName</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Registers the server under a certain name, so it can be found by a client.  <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>serverName</em>
&nbsp;</td><td>
 Name under which the server should be registered </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<a name="a3" doxytag="Server::detachServerName"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void detachServerName (
          </b></td>
          <td valign="bottom"><b>
)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Detaches the server name     </td>
  </tr>
</table>
<a name="a4" doxytag="Server::getServerName"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
const char * getServerName (
          </b></td>
          <td valign="bottom"><b>
) const<code> [inline]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the current server name     </td>
  </tr>
</table>
<a name="a5" doxytag="Server::doMessageLoop"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void doMessageLoop (
          </b></td>
          <td valign="bottom"><b>
)<code> [virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Continuously loops and waits for messages. For every message that arrives, <a class="el" href="class_Server.html#a6">serveMessage</a>() is called. Terminates if serverMessage() returns -1.     </td>
  </tr>
</table>
<a name="a6" doxytag="Server::serveMessage"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int serveMessage (
          </b></td>
          <td valign="bottom"><b>
pid_t <em>pid</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
void * <em>messageBuffer</em>&nbsp;)<code> [virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Serves a message. Terminates the message loop if -1 is returned or if the status is set to error. <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>pid</em>
&nbsp;</td><td>
 The pid of the client. </td></tr>
<tr><td valign=top><em>messageBuffer</em>
&nbsp;</td><td>
 The buffer where the message is stored. </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<a name="a7" doxytag="Server::replyMessage"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void replyMessage (
          </b></td>
          <td valign="bottom"><b>
const void * <em>message</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
int <em>messageSize</em>&nbsp;)<code> [inline]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Replies to a message. The reply is sent to the client from which the last message was received. <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>reply</em>
&nbsp;</td><td>
 Pointer to the reply. </td></tr>
<tr><td valign=top><em>replySize</em>
&nbsp;</td><td>
 Number of bytes of the reply. </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<a name="a8" doxytag="Server::replyMessage"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void replyMessage (
          </b></td>
          <td valign="bottom"><b>
)<code> [inline]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Replies with an empty message. The reply is sent to the client from which the last message was received.     </td>
  </tr>
</table>
<a name="a9" doxytag="Server::replyMessage"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void replyMessage (
          </b></td>
          <td valign="bottom"><b>
int <em>iReply</em>&nbsp;)<code> [inline]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Replies with an integer. The reply is sent to the client from which the last message was received. <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>iReply</em>
&nbsp;</td><td>
 The integer reply. </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<a name="a10" doxytag="Server::replyMessage"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void replyMessage (
          </b></td>
          <td valign="bottom"><b>
Status &amp; <em>status</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Replies with a status. The only the error code of the top status message is returned and all status messages combined together, as returned by Status::getMessageText(). The reply is sent to the client from which the last message was received. <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>status</em>
&nbsp;</td><td>
 The status reply. </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<a name="a11" doxytag="Server::receiveMessage"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void receiveMessage (
          </b></td>
          <td valign="bottom"><b>
void * <em>message</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
int <em>messageSize</em>&nbsp;)<code> [inline]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Receives a message. The message is received from the client from which the last message was received. <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>msg</em>
&nbsp;</td><td>
 Pointer to the message buffer. </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<a name="a12" doxytag="Server::receiveMessage"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int receiveMessage (
          </b></td>
          <td valign="bottom"><b>
)<code> [inline]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Receives an integer message. The message is received from the client from which the last message was received.     </td>
  </tr>
</table>
<a name="a13" doxytag="Server::receiveMessageFromAnybody"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
pid_t receiveMessageFromAnybody (
          </b></td>
          <td valign="bottom"><b>
void * <em>message</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
int <em>messageSize</em>&nbsp;)<code> [inline]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Receives a message from any process. <dl compact><dt>
<b>Returns: </b><dd>
 The pid of the process that sent the message </dl>    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="Server_hpp-source.html">Server.hpp</a></ul>
</body>
</html>
