<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DefaultManipulator.hpp Source File</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Wed Jul 2 17:00:17 2003 -->
<h1>DefaultManipulator.hpp</h1><div class="fragment"><pre>00001   
00002 
00003 <font class="preprocessor">#ifndef INCLUDED_DefaultManipulator_hpp</font>
00004 <font class="preprocessor"></font><font class="preprocessor">#define INCLUDED_DefaultManipulator_hpp</font>
00005 <font class="preprocessor"></font>  
00006 
00007 
00008 <font class="preprocessor">#include &lt;pthread.h&gt;</font>
00009 
00010 
00011 <font class="preprocessor">#include "RoboticPlatform.hpp"</font>
00012 <font class="preprocessor">#include "RoboticObject.hpp"</font>
00013 <font class="preprocessor">#include "PhysicalObject.hpp"</font>
00014 <font class="preprocessor">#include "DefaultPositionControl.hpp"</font>
00015 <font class="preprocessor">#include "VectorBase.hpp"</font>
00016 <font class="preprocessor">#include "OpenArchitectureManipulator.hpp"</font>
00017 <font class="preprocessor">#include "ManipulatorModel.hpp"</font>
00018 <font class="preprocessor">#include "Vector.hpp"</font>
00019 <font class="preprocessor">#include "Transform.hpp"</font>
00020 <font class="preprocessor">#include "Differentiator.hpp"</font>
00021 <font class="preprocessor">#include "Integrator.hpp"</font>
00022 <font class="preprocessor">#include "LowpassFilter.hpp"</font>
00023 <font class="preprocessor">#include "Server.hpp"</font>
00024 <font class="preprocessor">#include "Client.hpp"</font>
00025 <font class="preprocessor">#include "ControlProgram.hpp"</font>
00026 <font class="preprocessor">#include "IOBoardClient.hpp"</font>
00027 <font class="preprocessor">#include "ObjectMessageDialog.hpp"</font>
00028 
00029 
00030   
00053 template &lt;int numJoints&gt;
00054 <font class="keyword">class </font><a class="code" href="class_DefaultManipulator.html">DefaultManipulator</a> : <font class="keyword">public</font> <a class="code" href="class_OpenArchitectureManipulator.html">OpenArchitectureManipulator</a>,
00055                                                       <font class="keyword">public</font> ControlProgram
00056 {
00057 
00058   <font class="keyword">protected</font>:
00059     <font class="keyword">typedef</font> <a class="code" href="class_OpenArchitectureManipulator.html">OpenArchitectureManipulator</a> <a class="code" href="class_OpenArchitectureManipulator.html">Parent</a>;
00060     
00061     <font class="keyword">protected</font>:
00062     <a class="code" href="class_DefaultManipulator.html#b0">DefaultManipulator</a>(<font class="keyword">const</font> TypeInfo *<a class="code" href="class_Manipulator.html">parent</a>);
00068   <font class="keyword">public</font>:
00069     <font class="keyword">virtual</font> <a class="code" href="class_DefaultManipulator.html#a0">~DefaultManipulator</a>();
00073     <font class="keyword">public</font>:     
00074     <font class="keyword">static</font> TypeInfoAbstractT&lt;DefaultManipulator&gt; s_typeInfo;
00080     <font class="keyword">virtual</font> <font class="keyword">const</font> TypeInfo *<a class="code" href="class_OpenArchitectureManipulator.html#a1">getTypeInfo</a>() <font class="keyword">const</font>;
00085   <font class="keyword">public</font>:
00086     Vector&lt;numJoints&gt; <a class="code" href="class_Manipulator.html#a5">getCurrentJointPosition</a>();
00093     Vector&lt;numJoints&gt; <a class="code" href="class_Manipulator.html#a6">getDesiredJointPosition</a>();
00100     <font class="keyword">virtual</font> Vector&lt;numJoints&gt; <a class="code" href="class_DefaultManipulator.html#a4">readJointPosition</a>();
00106     <font class="keyword">virtual</font> Vector&lt;numJoints&gt; <a class="code" href="class_DefaultManipulator.html#a5">convertJointOutputToMotorOutput</a>(
00107                                                                 <font class="keyword">const</font> Vector&lt;numJoints&gt; &amp;jointOutput);
00119     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a6">reset</a>();
00127   <font class="keyword">public</font>:
00128     
00129     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a7">readGlobalConfiguration</a>(Config *config);
00143     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a8">setSimulationModeOn</a>();
00149     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a9">setSimulationModeOff</a>();
00157     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a2">outputInfo</a>(ostream &amp;stream = cout);
00165     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a28">createControlPanel</a>(<font class="keywordtype">bool</font> realizeFlag = <font class="keyword">true</font>);
00171   <font class="keyword">protected</font>:    
00172     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#b1">updateGUI</a>();
00176   <font class="keyword">public</font>:
00177 
00178     <font class="keyword">virtual</font> <font class="keyword">inline</font> <font class="keywordtype">int</font> <a class="code" href="class_Manipulator.html#a3">getNumJoints</a>();
00183     <font class="keyword">virtual</font> <font class="keywordtype">bool</font> <a class="code" href="class_Manipulator.html#a4">isJointRevolute</a>(<font class="keywordtype">int</font> jointNumber);
00188     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a5">getCurrentJointPosition</a>(VectorBase&lt;&gt; &amp;currentJointPosition);
00196     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a6">getDesiredJointPosition</a>(VectorBase&lt;&gt; &amp;desiredJointPosition);
00206     <font class="keyword">virtual</font> <font class="keywordtype">double</font> <a class="code" href="class_Manipulator.html#a5">getCurrentJointPosition</a>(<font class="keywordtype">int</font> jointNumber);
00212     <font class="keyword">virtual</font> <font class="keywordtype">double</font> <a class="code" href="class_Manipulator.html#a6">getDesiredJointPosition</a>(<font class="keywordtype">int</font> jointNumber);
00220     <font class="keyword">virtual</font> Transform <a class="code" href="class_Manipulator.html#a9">getCurrentCartesianPosition</a>();
00227     <font class="keyword">virtual</font> Transform <a class="code" href="class_Manipulator.html#a10">getDesiredCartesianPosition</a>();
00232     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a20">getCurrentJointVelocity</a>(VectorBase&lt;&gt; &amp;jointVelocity);
00237     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a21">getCurrentJointAcceleration</a>(VectorBase&lt;&gt;
00238                                                                                      &amp;jointAcceleration);
00244     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a11">getDefaultJointVelocity</a>(VectorBase&lt;&gt; 
00245                                 &amp;jointVelocity) <font class="keyword">const</font>;
00253     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a12">getDefaultJointAcceleration</a>(VectorBase&lt;&gt;
00254                                                                                      &amp;jointAcceleration) <font class="keyword">const</font>;
00264     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a13">calibrateJointPosition</a>(<font class="keyword">const</font> VectorBase&lt;&gt; &amp;jointPosition);
00278     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a14">setDesiredJointPosition</a>(<font class="keyword">const</font> VectorBase&lt;&gt;
00279                                                                              &amp;desiredJointPosition);
00290     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a15">setDesiredCartesianPosition</a>(
00291                                                          Transform &amp;desiredEndEffectorTransform);
00299     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a25">setTrajectoryGenerator</a>(
00300                                                  TrajectoryGenerator &amp;trajectoryGenerator);
00320     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a16">enableArmPower</a>();
00332     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a17">disableArmPower</a>();
00344     <font class="keyword">virtual</font> <font class="keywordtype">bool</font> <a class="code" href="class_Manipulator.html#a18">isArmPowerEnabled</a>();
00350     <font class="keyword">virtual</font> VectorBase&lt;&gt; *<a class="code" href="class_Manipulator.html#a19">createJointVector</a>();
00357     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a20">setTeachModeOn</a>();
00363     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_Manipulator.html#a21">setTeachModeOff</a>();
00367     <font class="keyword">virtual</font> <font class="keywordtype">bool</font> <a class="code" href="class_Manipulator.html#a22">isTeachModeOn</a>();
00374     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_OpenArchitectureManipulator.html#a9">setJointControlOutput</a>(<font class="keyword">const</font> VectorBase&lt;&gt; &amp;controlOutput);
00383     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_OpenArchitectureManipulator.html#a9">setJointControlOutput</a>(<font class="keywordtype">int</font> jointnumber, <font class="keywordtype">double</font> controlOutput);
00393     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_OpenArchitectureManipulator.html#a11">getJointControlOutput</a>(VectorBase&lt;&gt; &amp;controlOutput);
00401     <font class="keyword">virtual</font> <font class="keywordtype">double</font> <a class="code" href="class_OpenArchitectureManipulator.html#a8">getControlPeriod</a>();
00408 <font class="keyword">private</font>:
00409 
00410     <font class="keywordtype">void</font> checkJointLimits();
00416     <font class="keywordtype">void</font> checkTorqueLimits();
00424 <font class="keyword">public</font>:
00425 
00426     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a39">setGravityCompensationOn</a>();
00436     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a40">setGravityCompensationOff</a>();
00443     <font class="keywordtype">bool</font> <a class="code" href="class_DefaultManipulator.html#a41">isGravityCompensationOn</a>();
00449     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a42">setFrictionCompensationOn</a>();
00463     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a43">setFrictionCompensationOff</a>();
00470     <font class="keywordtype">bool</font> <a class="code" href="class_DefaultManipulator.html#a44">isFrictionCompensationOn</a>();
00476     <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a45">setDynamicSimulationModeOn</a>();
00484     <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a46">setDynamicSimulationModeOff</a>();
00488     <font class="keywordtype">bool</font> <a class="code" href="class_DefaultManipulator.html#a47">isDynamicSimulationModeOn</a>();
00493     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a48">startShutdown</a>();
00502     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#a49">onControlProgramError</a>( <font class="keywordtype">int</font> errorCode );
00507     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_DefaultManipulator.html#a50">enterControl</a>();
00514     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_DefaultManipulator.html#a51">startControl</a>();
00521     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_DefaultManipulator.html#a52">stopControl</a>();
00527     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_DefaultManipulator.html#a53">exitControl</a>();
00533     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_DefaultManipulator.html#a54">control</a>();
00539     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_DefaultManipulator.html#a55">handleMessage</a>(pid_t clientPid, <font class="keywordtype">char</font> *messageBuffer);
00547 <font class="keyword">public</font>:
00548   
00549 <font class="preprocessor">#ifndef DOXYGEN</font>
00550 <font class="preprocessor"></font>
00554   <font class="keyword">enum</font>
00555     {
00556         e_getJointPosition = 200,
00557         e_calibrateJointPosition,
00558         e_setDesiredJointPosition,
00559         e_setDesiredCartesianPosition,
00560         e_getDesiredJointPosition,
00561         e_getJointVelocity,
00562         e_getJointAcceleration,
00563         e_getJointOutput,
00564         e_setJointOutput,
00565         e_reset,
00566         e_init
00567     };    <font class="comment">// end of messages</font>
00568 
00569 <font class="preprocessor">#endif</font>
00570 <font class="preprocessor"></font>
00571 <font class="keyword">protected</font>:  
00572 
00573       
00574     <font class="keyword">virtual</font> ControlProgram *<a class="code" href="class_DefaultManipulator.html#b2">getQMotorControlProgram</a>();
00579     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#b3">localInit</a>();
00584     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_DefaultManipulator.html#b4">finishInit</a>();
00589 <font class="keyword">protected</font>:
00590   
00591     <font class="keywordtype">int</font> d_encoderStartChannel;
00595     <font class="keywordtype">int</font> d_dacStartChannel;
00600     <font class="keywordtype">int</font> d_armPowerDigitalOutChannel;
00605     <font class="keywordtype">int</font> d_armPowerDigitalInChannel;
00610     <font class="keywordtype">int</font> d_armPowerDigitalInValue;
00615     <font class="keywordtype">int</font> d_armPowerDigitalOutValue;
00620     Vector&lt;numJoints, int&gt; d_encoderCountPerRadian;
00626     Vector&lt;numJoints&gt; d_radiansAtZeroEncoder;
00630     Vector&lt;numJoints&gt; d_encoderPosition;
00634     Vector&lt;numJoints&gt; d_torqueToVoltageFactor;
00640     Vector&lt;numJoints&gt; d_desiredJointPosition;
00647     Transform d_desiredEndEffectorTransform;
00652     Vector&lt;numJoints&gt; d_defaultJointVelocity;
00657     Vector&lt;numJoints&gt; d_desiredJointVelocity;
00662     Vector&lt;numJoints&gt; d_defaultJointAcceleration;
00667     Vector&lt;numJoints&gt; d_desiredJointAcceleration;
00672     <font class="keywordtype">double</font> d_velocityFilterCutOffFrequencyHz;
00676     <font class="keywordtype">double</font> d_accelerationFilterCutOffFrequencyHz;
00680     <font class="keywordtype">double</font> d_velocityFilterDampingRatio;
00684     <font class="keywordtype">double</font> d_accelerationFilterDampingRatio;
00688     <font class="keywordtype">double</font> d_desiredVelocityFilterCutOffFrequencyHz;
00692     <font class="keywordtype">double</font> d_desiredAccelerationFilterCutOffFrequencyHz;
00696     <font class="keywordtype">double</font> d_desiredVelocityFilterDampingRatio;
00700     <font class="keywordtype">double</font> d_desiredAccelerationFilterDampingRatio;
00704     IOBoardClient *d_ioBoardClient;
00708     <font class="keyword">const</font> <font class="keywordtype">char</font> *d_ioBoardServerName;
00713 };
00714 <font class="preprocessor">#undef RP_DEBUG</font>
00715 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
</font></div></pre></body>
</html>
