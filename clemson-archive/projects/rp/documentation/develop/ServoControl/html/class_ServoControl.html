<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ServoControl Class Reference</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Tue Sep 18 06:17:45 2001 -->
<h1>ServoControl  Class Reference</h1>Base class for servo control classes. 
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="ServoControl_hpp-source.html">ServoControl.hpp</a>&gt;</code>
<p>
<p>Inheritance diagram for ServoControl:
<p><center><img src="class_ServoControl.gif" usemap="#ServoControl_map" border="0"></center>
<map name="ServoControl_map">
<area href="class_DefaultPositionControl.html" alt="DefaultPositionControl" shape="rect" coords="0,56,137,80">
</map>
<a href="class_ServoControl-members.html">List of all members.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Public Methods</h2></td></tr>
<tr><td nowrap align=right valign=top>virtual const TypeInfo*&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#a0">getTypeInfo</a> () const</td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#a1">registerControlProgramVariables</a> ( ControlProgram *controlProgram)</td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#a2">reset</a> (OpenArchitectureManipulator *manipulator)</td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#a3">calculateControlCycle</a> () = 0</td></tr>
<tr><td nowrap align=right valign=top>OpenArchitectureManipulator*&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#a4">getManipulator</a> ()</td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#a5">setCartesianControlMode</a> () = 0</td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#a6">setJointControlMode</a> () = 0</td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#a7">isCartesianControlMode</a> ()</td></tr>
<tr><td colspan=2><br><h2>Static Public Attributes</h2></td></tr>
<tr><td nowrap align=right valign=top>TypeInfoAbstractT&lt;ServoControl&gt;&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#p0">s_typeInfo</a></td></tr>
<tr><td colspan=2><br><h2>Protected Methods</h2></td></tr>
<tr><td nowrap align=right valign=top>&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#b0">ServoControl</a> (const TypeInfo *parent)</td></tr>
<tr><td nowrap align=right valign=top>virtual&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#b1">~ServoControl</a> ()</td></tr>
<tr><td colspan=2><br><h2>Protected Attributes</h2></td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="class_ServoControl.html#n0">d_cartesianModeEnabled</a></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Base class for servo control classes.
<p>
The class ServoControl is an abstract base class that defines a common interface and common properties of a servo control algorithm. That is, a servo control reads the control input from a manipulator object and calculates the required output control signal to achieve the control task (e.g. servo to a desired position).
<p>
<b>Example Program:</b>
<p>
<div class="fragment"><pre><font class="comment">//======================================================================== </font>
<font class="comment">// Project: Robotic Platform</font>
<font class="comment">// ---------------------------------------------------------------------- </font>
<font class="comment">// Package: Servo Control Classes</font>
<font class="comment">// Authors: Markus Loffler</font>
<font class="comment">// Start Date: Mon Dec 04 14:45:02 utc 2000</font>
<font class="comment">// ----------------------------------------------------------------------  </font>
<font class="comment">// File: ServoControl.t.cpp</font>
<font class="comment">// Example program for the class ServoControl.</font>
<font class="comment">// This example program is a good example on how to create a custom</font>
<font class="comment">// servo control. It also demonstrates the use of the manipulator</font>
<font class="comment">// model functions and the math library. Virtual walls are planes in</font>
<font class="comment">// the manipulator's workspace that generate a reaction force once</font>
<font class="comment">// the manipulator is moved into them.</font>
<font class="comment">//========================================================================  </font>

 

<font class="comment">// ----- Standard Libaries -----</font>
<font class="preprocessor">#include &lt;iostream.h&gt;</font>

<font class="comment">// ----- QRTS Libraries -----</font>

<font class="comment">// ----- Project Includes -----</font>
<font class="preprocessor">#include "RoboticPlatform.hpp"</font>
<font class="preprocessor">#include "DefaultPositionControl.hpp"</font>
<font class="preprocessor">#include "Vector.hpp"</font>
<font class="preprocessor">#include "Transform.hpp"</font>
<font class="preprocessor">#include "OpenArchitectureManipulator.hpp"</font>
<font class="preprocessor">#include "ManipulatorModel.hpp"</font>
<font class="preprocessor">#include "Puma560.hpp"</font>


<font class="comment">//======================================================================== </font>
<font class="comment">// class VirtualWallsServoControl</font>
<font class="comment">//========================================================================  </font>
 
template &lt;int numJoints&gt;
<font class="keyword">class </font>VirtualWallServoControl : <font class="keyword">public</font> <a class="code" href="class_ServoControl.html">ServoControl</a>
{
 <font class="keyword">public</font>:
  VirtualWallServoControl() : <a class="code" href="class_ServoControl.html">ServoControl</a>(0) {}
 
  <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="class_ServoControl.html#a3">calculateControlCycle</a>()<font class="keyword"></font>
<font class="keyword">  </font>{
    Vector &lt;numJoints&gt; torque;    <font class="comment">// The control torque</font>
    torque = 0;
    OpenArchitectureManipulator *manipulator = <a class="code" href="class_ServoControl.html#a4">getManipulator</a>();
    ManipulatorModel *model = manipulator-&gt;getManipulatorModel();
  
    <font class="comment">// What is the distance of the end-effector to the wall?</font>
    Transform x = manipulator-&gt;getCurrentEndEffectorTransform();
    <font class="keywordtype">double</font> distance = dotProduct(wallCoefficients, x.getColumn(4));
    
    <font class="keywordflow">if</font> (distance &gt; 0)
    {
      <font class="comment">// We are inside the wall. Calculate reacting force.</font>
      Vector&lt;6&gt; forceTorque;
      forceTorque.setSubMatrix(1, 1, distance * wallCoefficients * kf);
      forceTorque(4) = 0;
      
      <font class="comment">// Convert to joint space</font>
      Vector&lt;numJoints&gt; q;
      manipulator-&gt;getCurrentJointPosition(q);
      Matrix&lt;numJoints, 6&gt; jacobianTranspose;
      model-&gt;jacobianTranspose(q, jacobianTranspose);
      torque = jacobianTranspose * forceTorque;
    } 
    
    <font class="comment">// Do the control output</font>
    manipulator-&gt;setJointControlOutput(torque);
  } 

  Vector&lt;4&gt; wallCoefficients;
  <font class="keywordtype">double</font> kf;
};


<font class="comment">//======================================================================== </font>
<font class="comment">// main</font>
<font class="comment">//========================================================================  </font>
 
<font class="keywordtype">int</font> main(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[])<font class="keyword"></font>
<font class="keyword"></font>{
  RoboticPlatform::init(argc, argv);
  
  Puma560 puma;
  
  <font class="comment">// Virtual walls control for 6 joints</font>
  VirtualWallServoControl&lt;6&gt; wallControl;
  wallControl.kf = 0.01;
  wallControl.wallCoefficients = 0, 0, -1, 3;
  
  puma.setGravityCompensationOn();
  puma.setServoControl(wallControl);
  
  <font class="keywordflow">return</font> 0;
}
</div></pre> 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a name="b0" doxytag="ServoControl::ServoControl"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
ServoControl (
          </b></td>
          <td valign="bottom"><b>
const TypeInfo * <em>parent</em>&nbsp;)<code> [protected]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The constructor performs no action. This constructor is only called from the constructor of a derived class.     </td>
  </tr>
</table>
<a name="b1" doxytag="ServoControl::~ServoControl"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
~ServoControl (
          </b></td>
          <td valign="bottom"><b>
)<code> [protected, virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The destructor performs no action.     </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a name="a0" doxytag="ServoControl::getTypeInfo"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
const TypeInfo * getTypeInfo (
          </b></td>
          <td valign="bottom"><b>
) const<code> [virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the type info of the class. <dl compact><dt>
<b>See also: </b><dd>
 RoboticObject::getTypeInfo() </dl>
<p>
Reimplemented in <a class="el" href="class_DefaultPositionControl.html#a3">DefaultPositionControl</a>.    </td>
  </tr>
</table>
<a name="a1" doxytag="ServoControl::registerControlProgramVariables"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void registerControlProgramVariables (
          </b></td>
          <td valign="bottom"><b>
ControlProgram * <em>controlProgram</em>&nbsp;)<code> [virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Registers the log variables and control parameters related to the servo control in the QMotor control program.
<p>
This class performs no action. <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>controlProgram</em>
&nbsp;</td><td>
 A pointer to the control program. </td></tr>
</table>
</dl>
<p>
Reimplemented in <a class="el" href="class_DefaultPositionControl.html#a4">DefaultPositionControl</a>.    </td>
  </tr>
</table>
<a name="a2" doxytag="ServoControl::reset"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void reset (
          </b></td>
          <td valign="bottom"><b>
OpenArchitectureManipulator * <em>manipulator</em>&nbsp;)<code> [virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is called to reset the servo control. This happens when: <ul>
 <li>The servo control is connected to a new manipulator. <li>The manipulator position has changed abruptly. This can be the case because the manipulator was calibrated to a new  position, or this servo control had been disabled for a while and the manipulator was moved during this time (e.g., when using zero gravity teaching). <ul>
 A derived class should get the new position from the  Manipulator object and initialize internal variables (e.g., filters, integrators, and differentiators) to this new position to avoid any unexpected manipulator movement.
<p>
This class just sets an internal pointer to <em>manipulator</em>. This pointer can be retrieved by calling <a class="el" href="class_ServoControl.html#a4">getManipulator</a>(). A derived class should call first the <a class="el" href="class_ServoControl.html#a2">reset</a>() function of the parent class. <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>manipulator</em>
&nbsp;</td><td>
 A pointer to the manipulator object. </td></tr>
</table>
</dl>
<p>
Reimplemented in <a class="el" href="class_DefaultPositionControl.html#a5">DefaultPositionControl</a>.    </td>
  </tr>
</table>
<a name="a3" doxytag="ServoControl::calculateControlCycle"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void calculateControlCycle (
          </b></td>
          <td valign="bottom"><b>
)<code> [pure virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is called every cycle of a manipulator control loop. It calculates one cycle of the servo control algorithm, then forwards the control signal to the manipulator. 
<p>
Reimplemented in <a class="el" href="class_DefaultPositionControl.html#a6">DefaultPositionControl</a>.    </td>
  </tr>
</table>
<a name="a4" doxytag="ServoControl::getManipulator"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
OpenArchitectureManipulator * getManipulator (
          </b></td>
          <td valign="bottom"><b>
)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Determines the manipulator object that is associated with the servo control. <dl compact><dt>
<b>Returns: </b><dd>
 A pointer to the associated manipulator object. </dl>    </td>
  </tr>
</table>
<a name="a5" doxytag="ServoControl::setCartesianControlMode"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void setCartesianControlMode (
          </b></td>
          <td valign="bottom"><b>
)<code> [pure virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The servo controller is set to cartesian mode. In this mode the servo controller responds to end-effector position error defined in cartesian co-ordinates. Not all servo controllers can switch between cartesian and joint control. The derived class must therefore implement this function, as well as the default mode of operation of the controller. This class sets the default mode to joint level control. 
<p>
Reimplemented in <a class="el" href="class_DefaultPositionControl.html#a7">DefaultPositionControl</a>.    </td>
  </tr>
</table>
<a name="a6" doxytag="ServoControl::setJointControlMode"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void setJointControlMode (
          </b></td>
          <td valign="bottom"><b>
)<code> [pure virtual]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
In joint control mode, the servo controller responds to position error defined in joint space ( angle of each joint of the manipulator). The derived class must therefore implement this function, as well as the default mode of operation of the controller. This class sets the default mode to joint level control. 
<p>
Reimplemented in <a class="el" href="class_DefaultPositionControl.html#a8">DefaultPositionControl</a>.    </td>
  </tr>
</table>
<a name="a7" doxytag="ServoControl::isCartesianControlMode"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
bool isCartesianControlMode (
          </b></td>
          <td valign="bottom"><b>
)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt>
<b>Returns: </b><dd>
 true if control mode is cartesian. false if control is joint level. </dl>    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a name="p0" doxytag="ServoControl::s_typeInfo"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
TypeInfoAbstractT&lt; ServoControl &gt; s_typeInfo<code> [static]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The static type info object of the class. Every class derived from RoboticObject must have this static data member and initialize it correctly. 
<p>
Reimplemented in <a class="el" href="class_DefaultPositionControl.html#p0">DefaultPositionControl</a>.    </td>
  </tr>
</table>
<a name="n0" doxytag="ServoControl::d_cartesianModeEnabled"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
bool d_cartesianModeEnabled<code> [protected]</code>
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
true if control mode is cartesian. false if control mode is joint level.     </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="ServoControl_hpp-source.html">ServoControl.hpp</a></ul>
</body>
</html>
