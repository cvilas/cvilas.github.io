<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ControlProgram.hpp Source File</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Thu Jul 26 18:57:11 2001 -->
<h1>ControlProgram.hpp</h1><div class="fragment"><pre>00001 
00002 <font class="preprocessor">#ifndef INCLUDED_CONTROLPROGRAM_HPP</font>
00003 <font class="preprocessor"></font><font class="preprocessor">#define INCLUDED_CONTROLPROGRAM_HPP</font>
00004 <font class="preprocessor"></font>
00005 <font class="preprocessor">#ifdef NTO</font>
00006 <font class="preprocessor"></font><font class="preprocessor">    #include &lt;pthread.h&gt;</font>
00007 <font class="preprocessor">    #include "MatrixBase.hpp"</font>
00008 <font class="preprocessor">    #include "Barrier.hpp"</font>
00009 <font class="preprocessor">#else</font>
00010 <font class="preprocessor"></font><font class="preprocessor">    #include &lt;stdiobuf.h&gt;</font>
00011 <font class="preprocessor">#endif</font>
00012 <font class="preprocessor"></font>
00013 
00014 
00015 
00016 <font class="preprocessor">#ifndef DOXYGEN</font>
00017 <font class="preprocessor"></font>
00024 <font class="keyword">class </font>DebugStreambuf : <font class="keyword">public</font> streambuf
00025 {
00026 <font class="keyword">private</font>:
00027     <font class="keyword">enum</font> Mode { e_noOutput, e_useStdOut, e_useFileDescriptor };
00028 
00029 <font class="keyword">public</font>:
00030 
00031       DebugStreambuf() :
00032         streambuf(),
00033         d_mode(e_noOutput),
00034         d_outputFd(0) {}
00035 
00036       <font class="keyword">virtual</font> <font class="keywordtype">int</font> overflow (<font class="keywordtype">int</font> ch = EOF);
00042     <font class="keyword">virtual</font> <font class="keywordtype">int</font> underflow ();
00047     <font class="keywordtype">void</font> setOutputFileDescriptor(<font class="keywordtype">int</font> fileDescriptor)<font class="keyword"></font>
00048 <font class="keyword">        </font>{ d_mode = e_useFileDescriptor; d_outputFd = fileDescriptor; }
00049         
00050     <font class="keywordtype">void</font> setOutputOff()<font class="keyword"> </font>{ d_mode = e_noOutput; }
00051     <font class="keywordtype">void</font> setOutputStdOut()<font class="keyword"> </font>{ d_mode = e_useStdOut; }
00052     
00053   <font class="keyword">private</font>:
00054     <font class="keyword">enum</font> Mode d_mode;
00055     <font class="keywordtype">int</font> d_outputFd;
00056 };
00057 
00058 <font class="preprocessor">#endif</font>
00059 <font class="preprocessor"></font>
00060 
00112 <font class="keyword">class </font><a class="code" href="class_ControlProgram.html">ControlProgram</a> : <font class="keyword">public</font> Server
00113 { 
00114 <font class="preprocessor">    #ifndef DOXYGEN</font>
00115 <font class="preprocessor"></font>        <font class="keyword">friend</font> <font class="keyword">class </font>Supervisor;
00116         <font class="keyword">friend</font> <font class="keyword">class </font>MainWindow;
00117 <font class="preprocessor">    #endif</font>
00118 <font class="preprocessor"></font>
00119   <font class="keyword">public</font>: 
00120     
00121     <font class="keyword">enum</font> { e_messageBufferSize = 4096 };
00125     <a class="code" href="class_ControlProgram.html#a0">ControlProgram</a>(<font class="keywordtype">int</font> argc = 0, <font class="keywordtype">char</font> *argv[] = 0,
00126                                  <font class="keyword">const</font> <font class="keywordtype">char</font> *timerServerName = <font class="stringliteral">"qrts/ts0"</font>,
00127                                  <font class="keywordtype">int</font> priority = 27);
00160     <font class="keyword">virtual</font> <a class="code" href="class_ControlProgram.html#a1">~ControlProgram</a>();
00164 <font class="preprocessor">    #ifndef DOXYGEN</font>
00165 <font class="preprocessor"></font>    <font class="keywordtype">void</font> setCommandLineArguments(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[]);
00171 <font class="preprocessor">  #endif</font>
00172 <font class="preprocessor"></font>    
00173     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a2">run</a> ();
00178 <font class="preprocessor">    #ifndef DOXYGEN</font>
00179 <font class="preprocessor"></font><font class="preprocessor">    #ifdef NTO</font>
00180 <font class="preprocessor"></font>    
00181             
00188         pthread_t runInThread();
00202         pthread_t runInThreadBlocking();
00216         <font class="keywordtype">int</font> waitForStart();
00224         <font class="keywordtype">void</font> stopControlLoopInThread();
00235         <font class="keywordtype">int</font> isControlProgramRunningInThread()<font class="keyword"> </font>{ <font class="keywordflow">return</font> d_runningInThread; }
00245         <font class="keyword">private</font>:
00246 <font class="preprocessor">            #ifdef NTO</font>
00247 <font class="preprocessor"></font>                Barrier *d_initControlLoopBarrier;
00248 <font class="preprocessor">            #endif</font>
00249 <font class="preprocessor"></font>            <font class="keywordtype">int</font> d_runningInThread;
00250 <font class="preprocessor">    #endif</font>
00251 <font class="preprocessor"></font><font class="preprocessor">    #endif</font>
00252 <font class="preprocessor"></font>
00253 <font class="keyword">public</font>:
00254 <font class="preprocessor">    #ifndef DOXYGEN</font>
00255 <font class="preprocessor"></font>    <font class="keywordtype">void</font> setMasterMode();
00271     <font class="keywordtype">int</font> isMasterMode();
00277     <font class="keywordtype">void</font> setAutorunGUIOn();
00286     <font class="keywordtype">void</font> setAutorunGUIOff();
00293     <font class="keywordtype">int</font> isAutorunGUIOn();
00299 <font class="preprocessor">  #endif</font>
00300 <font class="preprocessor"></font>                    
00301     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a3">mainLoop</a> ();
00305     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a4">enableSupervisorMode</a>();
00310     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a5">disableSupervisorMode</a>();
00319     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a6">isSupervisorModeEnabled</a>();
00325     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a7">enableSignalHandling</a>();
00332     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a8">disableSignalHandling</a>();
00336     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a9">isSignalHandlingEnabled</a>();
00342 <font class="keyword">public</font>:
00343 
00344       
00345     <font class="keywordtype">double</font> d_controlFrequency;
00360     <font class="keywordtype">double</font> d_controlPeriod;
00374     <font class="keywordtype">double</font> d_controlDuration;
00388     <font class="keywordtype">int</font> d_runForever;
00402     <font class="keywordtype">double</font> d_elapsedTime;
00417     <font class="keywordtype">int</font> d_elapsedTicks;
00422     Config d_config;
00433     CmdLineArgs d_cmdLine;
00442     <font class="keywordtype">int</font> d_standAloneMode;
00447     ostream d_messageStream;
00460     ostream d_debugStream;
00467     <font class="keywordtype">char</font> *d_applicationName;
00476 <font class="preprocessor">    #ifndef DOXYGEN</font>
00477 <font class="preprocessor"></font>
00478     
00486 <font class="preprocessor">    #endif</font>
00487 <font class="preprocessor"></font>
00488 
00489 
00490 <font class="keyword">protected</font>:  
00491     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b0">enterControl</a>();
00521     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b1">readConfiguration</a>();
00544     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b2">startControl</a>();
00576     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b3">control</a>();
00607     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b4">startControlProgramShutdown</a>();
00619     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b5">stopControl</a>();
00643     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b6">exitControl</a>();
00662     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b7">handleMessage</a>(pid_t pid, <font class="keywordtype">char</font> *message);
00700 <font class="keyword">public</font>:
00701     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a10">registerLogVariable</a>(<font class="keywordtype">double</font> *address, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00702                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>,
00703                                                      <font class="keywordtype">int</font> numRows = 1, <font class="keywordtype">int</font> numColums = 1);
00731     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a10">registerLogVariable</a>(<font class="keywordtype">int</font> *address,  <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00732                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>,
00733                                                      <font class="keywordtype">int</font> numRows = 1, <font class="keywordtype">int</font> numColums = 1);
00743 <font class="preprocessor">#ifndef DOXYGEN</font>
00744 <font class="preprocessor"></font><font class="preprocessor">#ifdef NTO</font>
00745 <font class="preprocessor"></font>
00746     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a10">registerLogVariable</a>(MatrixBase&lt;double&gt; &amp;matrix, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00747                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>);
00759     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a10">registerLogVariable</a>(MatrixBase&lt;int&gt; &amp;matrix, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00760                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>);
00772 <font class="preprocessor">#endif</font>
00773 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00774 <font class="preprocessor"></font>
00775     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a12">registerControlParameter</a>(<font class="keywordtype">double</font> *address,  <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00776                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>,
00777                                                      <font class="keywordtype">int</font> numRows = 1, <font class="keywordtype">int</font> numColums = 1);
00799     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a12">registerControlParameter</a>(<font class="keywordtype">int</font> *address, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00800                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>,
00801                                                      <font class="keywordtype">int</font> numRows = 1, <font class="keywordtype">int</font> numColums = 1);
00812 <font class="preprocessor">#ifndef DOXYGEN</font>
00813 <font class="preprocessor"></font><font class="preprocessor">#ifdef NTO</font>
00814 <font class="preprocessor"></font>
00815     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a12">registerControlParameter</a>(MatrixBase&lt;double&gt; &amp;matrix, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00816                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>);
00828     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a12">registerControlParameter</a>(MatrixBase&lt;int&gt; &amp;matrix, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00829                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>);
00841 <font class="preprocessor">#endif</font>
00842 <font class="preprocessor"></font><font class="preprocessor">#endif                          </font>
00843 <font class="preprocessor"></font>                                                    
00844       
00845     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a14">clearAllLogVariables</a>();
00855     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a15">clearAllControlParameters</a>();
00866     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a16">setNoLogMode</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00881 <font class="preprocessor">    #ifndef DOXYGEN </font>
00882 <font class="preprocessor"></font>        <font class="keywordtype">void</font> setContinuousLogMode (<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00889 <font class="preprocessor">  #endif</font>
00890 <font class="preprocessor"></font>
00891     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a17">setTimedLogMode</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00908     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a18">setEventTriggeredLogMode</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00925     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a19">getLogVariableHandle</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00943     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a20">startLogging</a> (<font class="keywordtype">int</font> logVariableHandle);
00957     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a21">stopLogging</a> (<font class="keywordtype">int</font> logVariableHandle);
00972     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a22">setLogDuration</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName, <font class="keywordtype">double</font> logDuration);
00985     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a23">setLogFrequency</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName, <font class="keywordtype">double</font> logFrequency);
00998     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a24">setLogStartTime</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName, <font class="keywordtype">double</font> logStartTime);
01014 <font class="keyword">public</font>:
01015     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a25">setConfigurationFileName</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *configurationFileName);
<a name="l01023"></a><a class="code" href="class_ControlProgram.html#a26">01023</a>     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a26">isControlRunning</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> d_controlRunning; }
<a name="l01029"></a><a class="code" href="class_ControlProgram.html#a27">01029</a>     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a27">isControlShuttingDown</a>()<font class="keyword"> const</font>
01030 <font class="keyword">        </font>{ <font class="keywordflow">return</font> d_communicationBlock-&gt;d_controlShuttingDown; }
<a name="l01036"></a><a class="code" href="class_ControlProgram.html#a28">01036</a>     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a28">wasShutdownAborted</a>()<font class="keyword"> const</font>
01037 <font class="keyword">        </font>{ <font class="keywordflow">return</font> d_shutdownAborted; }
01045 <font class="keyword">protected</font>:
<a name="l01046"></a><a class="code" href="class_ControlProgram.html#b8">01046</a>     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#b8">shutdownComplete</a>()<font class="keyword"></font>
01047 <font class="keyword">        </font>{ d_communicationBlock-&gt;d_controlShuttingDown = 0; }
01054 <font class="keyword">public</font>:   
01055 <font class="preprocessor">    #ifndef DOXYGEN </font>
01056 <font class="preprocessor"></font>        <font class="keywordtype">double</font> getControlCycleCPUTime()<font class="keyword"></font>
01057 <font class="keyword">            </font>{ <font class="keywordflow">return</font> d_controlCycleCPUTime; }
01061 <font class="preprocessor">  #endif  </font>
01062 <font class="preprocessor"></font>    
01063 };
01064 <font class="preprocessor">#endif</font>
</font></div></pre></body>
</html>
