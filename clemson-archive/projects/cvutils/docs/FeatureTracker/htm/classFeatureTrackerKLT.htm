<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Real-time Feature Tracker Library: FeatureTrackerKLT Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="index.htm"><span>Main&nbsp;Page</span></a></li>
    <li id="current"><a href="annotated.htm"><span>Classes</span></a></li>
    <li><a href="files.htm"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="annotated.htm"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.htm"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.htm"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<h1>FeatureTrackerKLT Class Reference</h1><!-- doxytag: class="FeatureTrackerKLT" -->Automatic image feature detection and tracking using the Lucas-Kanade tracking algorithm implemented in the KLT library.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="FeatureTrackerKLT_8hpp-source.htm">FeatureTrackerKLT.hpp</a>&gt;</code>
<p>
<a href="classFeatureTrackerKLT-members.htm">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFeatureTrackerKLT.htm#a18d6bdac050b83266d97b45fb0c87ce">FeatureTrackerKLT</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFeatureTrackerKLT.htm#afe4d338754272e9cb268513cb3bf159">~FeatureTrackerKLT</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFeatureTrackerKLT.htm#96ad3d6eca25186abbf9699a1d4e7689">initialize</a> (<a class="el" href="struct__FeatureTrackerContext.htm">FeatureTrackerContext_t</a> &amp;ftc, KLT_TrackingContext kltc)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFeatureTrackerKLT.htm#76dfdce153549eefa436db148d1cfe94">processImage</a> (unsigned char *img, int w, int h, <a class="el" href="struct__feature__list.htm">feature_list_t</a> &amp;list)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFeatureTrackerKLT.htm#5b32a201db7f75f853a346784f50a80a">writeFeatureTable</a> (const char *fileBaseName)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Automatic image feature detection and tracking using the Lucas-Kanade tracking algorithm implemented in the KLT library. 
<p>
This class uses the implementation of the KLT algorithm developed and maintained by Stan Birchfield. See: <a href="http://www.ces.clemson.edu/~stb/klt">http://www.ces.clemson.edu/~stb/klt</a> . Image display and event handling routines use the SDL library . See: <a href="http://www.libsdl.org.">http://www.libsdl.org.</a><p>
<b>Example Program:</b> <div class="fragment"><pre class="fragment"><span class="comment">//==============================================================================</span>
<span class="comment">// FeatureTrackerKLT.t.cpp - Example program for FeatureTrackerKLT class</span>
<span class="comment">// Vilas Chitrakaran, May 2006</span>
<span class="comment">//==============================================================================</span>

<span class="preprocessor">#include "<a class="code" href="FeatureTrackerKLT_8hpp.htm">FeatureTrackerKLT.hpp</a>"</span>
<span class="preprocessor">#include "<a class="code" href="Pixmap_8hpp.htm">Pixmap.hpp</a>"</span>
<span class="preprocessor">#include &lt;unistd.h&gt;</span>

<span class="keywordtype">int</span> main()
{ 
 KLT_TrackingContext kltContext;
 <a class="code" href="struct__FeatureTrackerContext.htm">FeatureTrackerContext_t</a> tracContext;
 <a class="code" href="classPixmapGray.htm">PixmapGray</a> img[2];
 <a class="code" href="struct__feature__list.htm">feature_list_t</a> features;
 
 kltContext = KLTCreateTrackingContext();
 kltContext-&gt;lighting_insensitive = <span class="keyword">true</span>;
 kltContext-&gt;writeInternalImages = <span class="keyword">false</span>;
 kltContext-&gt;affineConsistencyCheck = -1;
 kltContext-&gt;window_width = 9;
 kltContext-&gt;window_height = 9;
 kltContext-&gt;max_iterations = 100;
 kltContext-&gt;mindist = 10;
 kltContext-&gt;smoothBeforeSelecting = <span class="keyword">true</span>;
 
 tracContext.<a class="code" href="struct__FeatureTrackerContext.htm#e9d5ae9b4bec8bfcf608f063ed875e49">num_features</a> = 4;
 tracContext.<a class="code" href="struct__FeatureTrackerContext.htm#92f148878d0e2288b7d3dad4a83579c6">num_frames</a> = 2;
 tracContext.<a class="code" href="struct__FeatureTrackerContext.htm#8fac2067f4061b99ac60593423ae1cff">auto_select_features</a> = <span class="keyword">false</span>;
 tracContext.<a class="code" href="struct__FeatureTrackerContext.htm#5b89d2eed4859762eb340a90bf88d0c9">display_tracked_features</a> = <span class="keyword">true</span>;
 
 <span class="comment">// create feature list</span>
 <span class="keywordflow">if</span>( <a class="code" href="TrackerUtils_8hpp.htm#8793e527b678779c3bcd08047adf29ab">allocateFeatureList</a>(features, tracContext.<a class="code" href="struct__FeatureTrackerContext.htm#e9d5ae9b4bec8bfcf608f063ed875e49">num_features</a>) &lt; 0 )
  <span class="keywordflow">return</span> -1;

 <a class="code" href="classFeatureTrackerKLT.htm">FeatureTrackerKLT</a> tracker;

 img[0].<a class="code" href="classPixmap.htm#1cd16f98faca76a7efeb0b8f43be4694">loadPixmap</a>(<span class="stringliteral">"images/box0.pgm"</span>);
 img[1].<a class="code" href="classPixmap.htm#1cd16f98faca76a7efeb0b8f43be4694">loadPixmap</a>(<span class="stringliteral">"images/box1.pgm"</span>);

 <span class="comment">// initialize system</span>
 <span class="keywordflow">if</span>( tracker.<a class="code" href="classFeatureTrackerKLT.htm#96ad3d6eca25186abbf9699a1d4e7689">initialize</a>(tracContext, kltContext) != 0 ) {
  fprintf(stderr, <span class="stringliteral">"ERROR initializing tracker.\n"</span>);
  <span class="keywordflow">return</span> -1;
 }

 <span class="comment">// track features between frames</span>
 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) {
  <span class="keywordflow">if</span>( tracker.<a class="code" href="classFeatureTrackerKLT.htm#76dfdce153549eefa436db148d1cfe94">processImage</a>(img[i].<a class="code" href="classPixmap.htm#c61314716a60f549164ed9cba6d4fe3b">getPointer</a>(0), img[i].<a class="code" href="classPixmap.htm#02e9822f3fe2f920ba1f5a66f83c573b">getWidth</a>(), 
                           img[i].<a class="code" href="classPixmap.htm#ad7a7553b8dd73c34b53f9dec153656f">getHeight</a>(), features) &lt; 0 ) {
   fprintf(stderr, <span class="stringliteral">"ERROR processing image.\n"</span>);
   <span class="keywordflow">return</span> -1;
  }

  <span class="comment">// print features</span>
  fprintf(stdout, <span class="stringliteral">"== frame %2d ==\n"</span>, i);
  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; tracContext.<a class="code" href="struct__FeatureTrackerContext.htm#e9d5ae9b4bec8bfcf608f063ed875e49">num_features</a>; ++j) {
   fprintf(stdout, <span class="stringliteral">"%2d (%3.1f, %3.1f)\n"</span>, features.<a class="code" href="struct__feature__list.htm#8e2e1c2bc6c829a57c6909bc72f1f217">features</a>[j].<a class="code" href="struct__feature.htm#8f8205ad1bd683d879e31651e6d6ba20">val</a>, 
           features.<a class="code" href="struct__feature__list.htm#8e2e1c2bc6c829a57c6909bc72f1f217">features</a>[j].<a class="code" href="struct__feature.htm#c3d93448e2d7e4c42f6cb81f5636575b">x</a>, features.<a class="code" href="struct__feature__list.htm#8e2e1c2bc6c829a57c6909bc72f1f217">features</a>[j].<a class="code" href="struct__feature.htm#6c24c67805f765e506360efabf4b89ce">y</a>);
  }
 }

 <span class="comment">// SDL events won't be caught outside processImage(), unless</span>
 <span class="comment">// you do this...</span>
 SDL_Event event;
 <span class="keywordflow">while</span>( SDL_PollEvent(&amp;event)  ) {
  <span class="keywordflow">if</span>(event.type == SDL_QUIT) {
   fprintf(stdout, <span class="stringliteral">"\nI was asked to quit!\n"</span>);
   <span class="keywordflow">return</span> -2;
  }
 }

 <span class="comment">// Write results to text.</span>
 <span class="keywordflow">if</span>( tracker.<a class="code" href="classFeatureTrackerKLT.htm#5b32a201db7f75f853a346784f50a80a">writeFeatureTable</a>(<span class="stringliteral">"trackedFeatures"</span>) != 0 ) {
  fprintf(stderr, <span class="stringliteral">"ERROR writing feature tables.\n"</span>);
  <span class="keywordflow">return</span> -1;
 }
 
 <a class="code" href="TrackerUtils_8hpp.htm#a5c4fd16fc87e9a0e3c260f835c25623">freeFeatureList</a>(features);
 KLTFreeTrackingContext(kltContext);

 <span class="keywordflow">return</span> 0;
}
</pre></div> 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a18d6bdac050b83266d97b45fb0c87ce"></a><!-- doxytag: member="FeatureTrackerKLT::FeatureTrackerKLT" ref="a18d6bdac050b83266d97b45fb0c87ce" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">FeatureTrackerKLT::FeatureTrackerKLT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Default constructor.     </td>
  </tr>
</table>
<a class="anchor" name="afe4d338754272e9cb268513cb3bf159"></a><!-- doxytag: member="FeatureTrackerKLT::~FeatureTrackerKLT" ref="afe4d338754272e9cb268513cb3bf159" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">FeatureTrackerKLT::~FeatureTrackerKLT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Destructor frees any allocated resources     </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="96ad3d6eca25186abbf9699a1d4e7689"></a><!-- doxytag: member="FeatureTrackerKLT::initialize" ref="96ad3d6eca25186abbf9699a1d4e7689" args="(FeatureTrackerContext_t &amp;ftc, KLT_TrackingContext kltc)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FeatureTrackerKLT::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__FeatureTrackerContext.htm">FeatureTrackerContext_t</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>ftc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>KLT_TrackingContext&nbsp;</td>
          <td class="mdname" nowrap> <em>kltc</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize the tracker. Call this method before calling any other methods of this class. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ftc</em>&nbsp;</td><td>settings specific to this class. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>kltc</em>&nbsp;</td><td>KLT algorithm specific settings. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success, -1 on error (error message redirected to stderr). </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="76dfdce153549eefa436db148d1cfe94"></a><!-- doxytag: member="FeatureTrackerKLT::processImage" ref="76dfdce153549eefa436db148d1cfe94" args="(unsigned char *img, int w, int h, feature_list_t &amp;list)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FeatureTrackerKLT::processImage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>img</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>w</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>h</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct__feature__list.htm">feature_list_t</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>list</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Track features in the image buffer. Upon calling this method the first time, features are selected either automatically (if 'auto_select_features' was turned on during initialization) or by the user. If 'display_tracked_features' was turned on during initialization, the image display window will be updated with the current image in the buffer and the location of tracked features are marked. <hr>
 NOTE: Calling this function initiates SDL event handling, including for SIGINT (CNTRL+C). Hence, to catch events outside of this method, use SDL functions such as SDL_PollEvent(). <hr>
 <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>img</em>&nbsp;</td><td>Pointer to image buffer. NOTE: image must be 8 bit grayscale. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>w,h</em>&nbsp;</td><td>Image dimensions in pixels. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>list</em>&nbsp;</td><td>List of tracked features. This list contains updated (x,y) locations of features and an integer value indicating whether the feature was tracked successfully (0) or not (-1). </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>current frame number on success (first frame = 1), -1 on error (error message redirected to stderr), -2 on user initiated quit. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="5b32a201db7f75f853a346784f50a80a"></a><!-- doxytag: member="FeatureTrackerKLT::writeFeatureTable" ref="5b32a201db7f75f853a346784f50a80a" args="(const char *fileBaseName)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FeatureTrackerKLT::writeFeatureTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fileBaseName</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Write the history of all tracked features into a feature table in ascii (.txt) and binary format (.ft). (See KLT library documentation for details on reading from feature table). The number of records in this feature table will be less than or equal to the 'num_frames' parameter in the FeatureTrackerContext_t passed to <a class="el" href="classFeatureTrackerKLT.htm#96ad3d6eca25186abbf9699a1d4e7689">initialize()</a>. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fileBaseName</em>&nbsp;</td><td>Base name of the file. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success, -1 on error (error message redirected to stderr). </dd></dl>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="FeatureTrackerKLT_8hpp-source.htm">FeatureTrackerKLT.hpp</a></ul>
<hr>
Created for project <code><font color="red"><b>Real-time Feature Tracker Library</b></font></code> on Thu Sep 14 20:30:15 EDT 2006
<br>
 for Vilas Kumar Chitrakaran (cvilas(@)ces.clemson.edu). 
<br>
Documentation generated using <a href=http://www.doxygen.org>Doxygen</a>
.
</body>
</html>
