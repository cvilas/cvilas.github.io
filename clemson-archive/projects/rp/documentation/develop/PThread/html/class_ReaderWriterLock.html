<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ReaderWriterLock Class Reference</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Thu Jul 19 12:56:59 2001 -->
<h1>ReaderWriterLock  Class Reference</h1>Wrapper for POSIX reader/writer locks. 
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="ReaderWriterLock_hpp-source.html">ReaderWriterLock.hpp</a>&gt;</code>
<p>
<a href="class_ReaderWriterLock-members.html">List of all members.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Public Methods</h2></td></tr>
<tr><td nowrap align=right valign=top>&nbsp;</td><td valign=bottom><a class="el" href="class_ReaderWriterLock.html#a0">ReaderWriterLock</a> ()</td></tr>
<tr><td nowrap align=right valign=top>&nbsp;</td><td valign=bottom><a class="el" href="class_ReaderWriterLock.html#a1">~ReaderWriterLock</a> ()</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="class_ReaderWriterLock.html#a2">lockForRead</a> (int priority = 0)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="class_ReaderWriterLock.html#a3">lockForWrite</a> (int priority = 0)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_ReaderWriterLock.html#a4">unlock</a> (int priority = 0)</td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Wrapper for POSIX reader/writer locks.
<p>
The class ReaderWriterLock is a wrapper for the POSIX pthread_rwlock_... functions. It implements reader/writer locks, i.e., a mechanism to prevent threads to access a resource whenever another thread is currently writing on it. Concurrent read access to the resource is not prevented.
<p>
<b>Example Program:</b>
<p>
<div class="fragment"><pre><font class="comment">//======================================================================== </font>
<font class="comment">// Project: QRTS Utility Classes</font>
<font class="comment">// ---------------------------------------------------------------------- </font>
<font class="comment">// Package: PThread Classes</font>
<font class="comment">// Authors: Markus Loffler  </font>
<font class="comment">// Start Date: Sun Apr 01 19:23:10 GMT 2001</font>
<font class="comment">// ----------------------------------------------------------------------  </font>
<font class="comment">// File: ReaderWriterLock.t.cpp</font>
<font class="comment">// Example program for the class ReaderWriterLock.</font>
<font class="comment">//</font>
<font class="comment">// This example uses three threads that continuously read and write</font>
<font class="comment">// to a buffer. Start with "-n" to disable the locks.</font>
<font class="comment">//========================================================================  </font>
 

<font class="comment">// ----- Standard Libaries -----</font>
<font class="preprocessor">#include &lt;iostream.h&gt;</font>

<font class="comment">// ----- QRTS Libraries -----</font>
<font class="preprocessor">#include "ReaderWriterLock.hpp"</font>


<font class="preprocessor">#define BUFFER_SIZE  100000</font>
<font class="preprocessor"></font> 
<font class="keywordtype">bool</font> useLock = <font class="keyword">true</font>;
<a class="code" href="class_ReaderWriterLock.html">ReaderWriterLock</a> rwlock;
<font class="keywordtype">int</font> buffer[BUFFER_SIZE];

 
<font class="comment">//======================================================================== </font>
<font class="comment">// setBuffer</font>
<font class="comment">//========================================================================  </font>

<font class="keywordtype">void</font> setBuffer(<font class="keywordtype">int</font> a)<font class="keyword"></font>
<font class="keyword"></font>{
  <font class="keywordflow">if</font> (useLock)
    rwlock.<a class="code" href="class_ReaderWriterLock.html#a3">lockForWrite</a>();
  
  <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; BUFFER_SIZE; i++)
    buffer[i] = a;

  <font class="keywordflow">if</font> (useLock)
    rwlock.<a class="code" href="class_ReaderWriterLock.html#a4">unlock</a>();
}

 
<font class="comment">//======================================================================== </font>
<font class="comment">// checkBuffer</font>
<font class="comment">//========================================================================  </font>

<font class="keywordtype">void</font> checkBuffer()<font class="keyword"></font>
<font class="keyword"></font>{
  <font class="keywordflow">if</font> (useLock)
    rwlock.<a class="code" href="class_ReaderWriterLock.html#a2">lockForRead</a>();
    
  <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; BUFFER_SIZE; i++)
  {
    <font class="keywordflow">if</font> (buffer[0] != buffer[i])
    {
      cout &lt;&lt; <font class="stringliteral">"Corrupted buffer."</font> &lt;&lt; endl;
      exit(0);
    }
  }

  cout &lt;&lt; <font class="stringliteral">"Buffer ok (all values are "</font> &lt;&lt; buffer[0] &lt;&lt; <font class="stringliteral">")"</font> &lt;&lt; endl;
  
  <font class="keywordflow">if</font> (useLock)
    rwlock.<a class="code" href="class_ReaderWriterLock.html#a4">unlock</a>();
}


<font class="comment">//======================================================================== </font>
<font class="comment">// thread</font>
<font class="comment">//========================================================================  </font>

<font class="keywordtype">void</font> *thread(<font class="keywordtype">void</font> *data)<font class="keyword"></font>
<font class="keyword"></font>{
  <font class="keywordtype">int</font> val = (<font class="keywordtype">int</font>) data;
  
  <font class="keywordflow">while</font> (1)
  {
    setBuffer(val);
    checkBuffer();
  }
}


<font class="comment">//======================================================================== </font>
<font class="comment">// main</font>
<font class="comment">//========================================================================  </font>

<font class="keywordtype">int</font> main(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[])<font class="keyword"></font>
<font class="keyword"></font>{
  <font class="keywordflow">if</font> (argc == 2)
    <font class="keywordflow">if</font> (strcmp(argv[1], <font class="stringliteral">"-n"</font>) == 0)
      useLock = <font class="keyword">false</font>;
      
  <font class="keywordtype">int</font> policy;

  <font class="keywordflow">for</font> (<font class="keywordtype">int</font> val = 1; val &lt;= 2; val++)
    pthread_create(0, 0, thread, (<font class="keywordtype">void</font> *) val);
  
  <font class="keywordflow">while</font> (1)
  {
    setBuffer(0);
    checkBuffer();
  }
}
</div></pre> 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a name="a0" doxytag="ReaderWriterLock::ReaderWriterLock"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
ReaderWriterLock (
          </b></td>
          <td valign="bottom"><b>
)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The constructor initializes the class.
<p>
In case initialization of the lock fails, the d_status member is set to "ERROR".     </td>
  </tr>
</table>
<a name="a1" doxytag="ReaderWriterLock::~ReaderWriterLock"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
~ReaderWriterLock (
          </b></td>
          <td valign="bottom"><b>
)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The destructor cleans up.     </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a name="a2" doxytag="ReaderWriterLock::lockForRead"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int lockForRead (
          </b></td>
          <td valign="bottom"><b>
int <em>priority</em> = 0&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The resource is locked for read access. If currently some other thread has locked the same resource for write access, the call to <a class="el" href="class_ReaderWriterLock.html#a2">lockForRead</a>() blocks the calling thread until that other thread has finished writing and has unlocked the resource with <a class="el" href="class_ReaderWriterLock.html#a4">unlock</a>(). Otherwise, the call to <a class="el" href="class_ReaderWriterLock.html#a2">lockForRead</a>() does not block the calling thread, but all other threads that attempt to lock the thread with <a class="el" href="class_ReaderWriterLock.html#a3">lockForWrite</a>().
<p>
The same thread that has called <a class="el" href="class_ReaderWriterLock.html#a2">lockForRead</a>() must call <a class="el" href="class_ReaderWriterLock.html#a4">unlock</a>() after it finished accessing the resource.
<p>
By specifying the parameter <em>priority</em>, the calling thread is able to raise its priority before setting the lock. This might be necessary to avoid priority inversion (a thread with a low priority might lock a resource and delay other  high priority threads waiting on that resource). In this case, the returned current priority must be specified in the call to unlock to restore the original priority.
<p>
In case this function fails, the d_status member is set to  "ERROR". <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>priority</em>
&nbsp;</td><td>
 If not 0, the calling thread's priority is set to this value. </td></tr>
</table>
</dl><dl compact><dt>
<b>Returns: </b><dd>
 The previous priority, only if the priority was changed, otherwise the 0 is returned.
<p>
</dl><b>Example:</b>
<p>
<div class="fragment"><pre>     <font class="comment">// Lock, but raise priority to not endanger</font>
     <font class="comment">// other thread that runs at priority 27.</font>
     <font class="keywordtype">int</font> oldPriority = lock.lockForRead(27);
     
     <font class="comment">// Change our structure</font>
     address.name = <font class="stringliteral">"Claudia"</font>;
     address.street = <font class="stringliteral">"1234 Long Ave"</font>;
    
     <font class="comment">// Unlock</font>
     lock.unlock(oldPriority);</div></pre>     </td>
  </tr>
</table>
<a name="a3" doxytag="ReaderWriterLock::lockForWrite"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int lockForWrite (
          </b></td>
          <td valign="bottom"><b>
int <em>priority</em> = 0&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The resource if locked for write access. If currently some other thread has locked the same resource either for read or write access, <a class="el" href="class_ReaderWriterLock.html#a3">lockForWrite</a>() blocks the calling thread until the other thread has finished accessing the resource and has unlocked the resource with <a class="el" href="class_ReaderWriterLock.html#a4">unlock</a>(). Otherwise, the call to <a class="el" href="class_ReaderWriterLock.html#a3">lockForWrite</a>(), but all other threads that attempt to lock the thread with <a class="el" href="class_ReaderWriterLock.html#a2">lockForRead</a>() or <a class="el" href="class_ReaderWriterLock.html#a3">lockForWrite</a>() will be blocked.
<p>
The same thread that has called <a class="el" href="class_ReaderWriterLock.html#a3">lockForWrite</a>() must call <a class="el" href="class_ReaderWriterLock.html#a4">unlock</a>() after it finished accessing the resource.
<p>
By specifying the parameter <em>priority</em>, the calling thread is able to raise its priority before setting the lock. This might be necessary to avoid priority inversion (a thread with a low priority might lock a resource and delay other  high priority threads waiting on that resource). In this case, the returned current priority must be specified in the call to unlock to restore the original priority.
<p>
In case this function fails, the d_status member is set to  "ERROR". <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>priority</em>
&nbsp;</td><td>
 If not 0, the calling thread's priority is set to this value. </td></tr>
</table>
</dl><dl compact><dt>
<b>Returns: </b><dd>
 The previous priority, only if the priority was changed, otherwise the 0 is returned. </dl>    </td>
  </tr>
</table>
<a name="a4" doxytag="ReaderWriterLock::unlock"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void unlock (
          </b></td>
          <td valign="bottom"><b>
int <em>priority</em> = 0&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The resource is unlocked. Other threads that are blocked on this lock might be released. If a priority is given, the thread is set to this priority after unlocking.
<p>
In case this function fails, the d_status member is set to  "ERROR". <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>priority</em>
&nbsp;</td><td>
 The new priority of the calling thread, after unlocking. </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="ReaderWriterLock_hpp-source.html">ReaderWriterLock.hpp</a></ul>
</body>
</html>
