<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ControlProgram.hpp Source File</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Thu Jul 19 13:03:27 2001 -->
<h1>ControlProgram.hpp</h1><div class="fragment"><pre>00001 
00002 <font class="preprocessor">#ifndef INCLUDED_CONTROLPROGRAM_HPP</font>
00003 <font class="preprocessor"></font><font class="preprocessor">#define INCLUDED_CONTROLPROGRAM_HPP</font>
00004 <font class="preprocessor"></font>
00005 <font class="preprocessor">#ifdef NTO</font>
00006 <font class="preprocessor"></font><font class="preprocessor">    #include &lt;pthread.h&gt;</font>
00007 <font class="preprocessor">    #include "MatrixBase.hpp"</font>
00008 <font class="preprocessor">    #include "Barrier.hpp"</font>
00009 <font class="preprocessor">#else</font>
00010 <font class="preprocessor"></font><font class="preprocessor">    #include &lt;stdiobuf.h&gt;</font>
00011 <font class="preprocessor">#endif</font>
00012 <font class="preprocessor"></font>
00013 
00014 
00015 
00016 <font class="preprocessor">#ifndef DOXYGEN</font>
00017 <font class="preprocessor"></font>
00024 <font class="keyword">class </font>DebugStreambuf : <font class="keyword">public</font> streambuf
00025 {
00026 <font class="keyword">private</font>:
00027     <font class="keyword">enum</font> Mode { e_noOutput, e_useStdOut, e_useFileDescriptor };
00028 
00029 <font class="keyword">public</font>:
00030 
00031       DebugStreambuf() :
00032         streambuf(),
00033         d_mode(e_noOutput),
00034         d_outputFd(0) {}
00035 
00036       <font class="keyword">virtual</font> <font class="keywordtype">int</font> overflow (<font class="keywordtype">int</font> ch = EOF);
00042     <font class="keyword">virtual</font> <font class="keywordtype">int</font> underflow ();
00047     <font class="keywordtype">void</font> setOutputFileDescriptor(<font class="keywordtype">int</font> fileDescriptor)<font class="keyword"></font>
00048 <font class="keyword">        </font>{ d_mode = e_useFileDescriptor; d_outputFd = fileDescriptor; }
00049         
00050     <font class="keywordtype">void</font> setOutputOff()<font class="keyword"> </font>{ d_mode = e_noOutput; }
00051     <font class="keywordtype">void</font> setOutputStdOut()<font class="keyword"> </font>{ d_mode = e_useStdOut; }
00052     
00053   <font class="keyword">private</font>:
00054     <font class="keyword">enum</font> Mode d_mode;
00055     <font class="keywordtype">int</font> d_outputFd;
00056 };
00057 
00058 <font class="preprocessor">#endif</font>
00059 <font class="preprocessor"></font>
00060 
00112 <font class="keyword">class </font><a class="code" href="class_ControlProgram.html">ControlProgram</a> : <font class="keyword">public</font> <a class="code" href="class_Server.html">Server</a>
00113 { 
00114 <font class="preprocessor">    #ifndef DOXYGEN</font>
00115 <font class="preprocessor"></font>        <font class="keyword">friend</font> <font class="keyword">class </font>Supervisor;
00116         <font class="keyword">friend</font> <font class="keyword">class </font>MainWindow;
00117 <font class="preprocessor">    #endif</font>
00118 <font class="preprocessor"></font>
00119   <font class="keyword">public</font>: 
00120     
00121     <font class="keyword">enum</font> { e_messageBufferSize = 4096 };
00125     <a class="code" href="class_ControlProgram.html#a0">ControlProgram</a>(<font class="keywordtype">int</font> argc = 0, <font class="keywordtype">char</font> *argv[] = 0,
00126                                  <font class="keyword">const</font> <font class="keywordtype">char</font> *timerServerName = <font class="stringliteral">"qrts/ts0"</font>,
00127                                  <font class="keywordtype">int</font> priority = 27);
00160     <font class="keyword">virtual</font> <a class="code" href="class_ControlProgram.html#a1">~ControlProgram</a>();
00164     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a2">setCommandLineArguments</a>(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[]);
00171     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a3">run</a> ();
00176 <font class="preprocessor">    #ifdef NTO</font>
00177 <font class="preprocessor"></font>    
00178             
00185         pthread_t <a class="code" href="class_ControlProgram.html#a4">runInThread</a>();
00199         pthread_t <a class="code" href="class_ControlProgram.html#a5">runInThreadBlocking</a>();
00213         <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a6">waitForStart</a>();
00221         <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a7">stopControlLoopInThread</a>();
<a name="l00232"></a><a class="code" href="class_ControlProgram.html#a8">00232</a>         <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a8">isControlProgramRunningInThread</a>()<font class="keyword"> </font>{ <font class="keywordflow">return</font> d_runningInThread; }
00242         <font class="keyword">private</font>:
00243 <font class="preprocessor">            #ifdef NTO</font>
00244 <font class="preprocessor"></font>                Barrier *d_initControlLoopBarrier;
00245 <font class="preprocessor">            #endif</font>
00246 <font class="preprocessor"></font>            <font class="keywordtype">int</font> d_runningInThread;
00247 <font class="preprocessor">    #endif</font>
00248 <font class="preprocessor"></font>
00249 <font class="keyword">public</font>:
00250     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a9">setMasterMode</a>();
00266     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a10">isMasterMode</a>();
00272     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a11">setAutorunGUIOn</a>();
00281     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a12">setAutorunGUIOff</a>();
00288     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a13">isAutorunGUIOn</a>();
00295     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a14">mainLoop</a> ();
00299     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a15">enableSupervisorMode</a>();
00304     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a16">disableSupervisorMode</a>();
00313     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a17">isSupervisorModeEnabled</a>();
00319     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a18">enableSignalHandling</a>();
00326     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a19">disableSignalHandling</a>();
00330     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a20">isSignalHandlingEnabled</a>();
00336 <font class="keyword">public</font>:
00337 
00338       
00339     <font class="keywordtype">double</font> d_controlFrequency;
00354     <font class="keywordtype">double</font> d_controlPeriod;
00368     <font class="keywordtype">double</font> d_controlDuration;
00382     <font class="keywordtype">int</font> d_runForever;
00396     <font class="keywordtype">double</font> d_elapsedTime;
00411     <font class="keywordtype">int</font> d_elapsedTicks;
00416     Config d_config;
00427     CmdLineArgs d_cmdLine;
00436     <font class="keywordtype">int</font> d_standAloneMode;
00441     ostream d_messageStream;
00454     ostream d_debugStream;
00461     <font class="keywordtype">char</font> *d_applicationName;
00470 <font class="preprocessor">    #ifndef DOXYGEN</font>
00471 <font class="preprocessor"></font>
00472     
00480 <font class="preprocessor">    #endif</font>
00481 <font class="preprocessor"></font>
00482 
00483 
00484 <font class="keyword">protected</font>:  
00485     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b0">enterControl</a>();
00515     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b1">readConfiguration</a>();
00538     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b2">startControl</a>();
00570     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b3">control</a>();
00601     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b4">startControlProgramShutdown</a>();
00613     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b5">stopControl</a>();
00637     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b6">exitControl</a>();
00656     <font class="keyword">virtual</font> <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#b7">handleMessage</a>(pid_t pid, <font class="keywordtype">char</font> *message);
00694 <font class="keyword">public</font>:
00695     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a21">registerLogVariable</a>(<font class="keywordtype">double</font> *address, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00696                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>,
00697                                                      <font class="keywordtype">int</font> numRows = 1, <font class="keywordtype">int</font> numColums = 1);
00725     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a21">registerLogVariable</a>(<font class="keywordtype">int</font> *address,  <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00726                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>,
00727                                                      <font class="keywordtype">int</font> numRows = 1, <font class="keywordtype">int</font> numColums = 1);
00737 <font class="preprocessor">#ifdef NTO</font>
00738 <font class="preprocessor"></font>
00739     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a21">registerLogVariable</a>(<a class="code" href="class_MatrixBase.html">MatrixBase&lt;double&gt;</a> &amp;matrix, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00740                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>);
00752     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a21">registerLogVariable</a>(<a class="code" href="class_MatrixBase.html">MatrixBase&lt;int&gt;</a> &amp;matrix, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00753                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>);
00765 <font class="preprocessor">#endif</font>
00766 <font class="preprocessor"></font>
00767     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a25">registerControlParameter</a>(<font class="keywordtype">double</font> *address,  <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00768                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>,
00769                                                      <font class="keywordtype">int</font> numRows = 1, <font class="keywordtype">int</font> numColums = 1);
00791     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a25">registerControlParameter</a>(<font class="keywordtype">int</font> *address, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00792                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>,
00793                                                      <font class="keywordtype">int</font> numRows = 1, <font class="keywordtype">int</font> numColums = 1);
00804 <font class="preprocessor">#ifdef NTO</font>
00805 <font class="preprocessor"></font>
00806     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a25">registerControlParameter</a>(<a class="code" href="class_MatrixBase.html">MatrixBase&lt;double&gt;</a> &amp;matrix, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00807                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>);
00819     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a25">registerControlParameter</a>(<a class="code" href="class_MatrixBase.html">MatrixBase&lt;int&gt;</a> &amp;matrix, <font class="keyword">const</font> <font class="keywordtype">char</font> *name,
00820                                                      <font class="keyword">const</font> <font class="keywordtype">char</font> *description = <font class="stringliteral">""</font>);
00832 <font class="preprocessor">#endif</font>
00833 <font class="preprocessor"></font>                                                    
00834                                                     
00835       
00836     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a29">clearAllLogVariables</a>();
00846     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a30">clearAllControlParameters</a>();
00857     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a31">setNoLogMode</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00872 <font class="preprocessor">    #ifndef DOXYGEN </font>
00873 <font class="preprocessor"></font>        <font class="keywordtype">void</font> setContinuousLogMode (<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00880 <font class="preprocessor">  #endif</font>
00881 <font class="preprocessor"></font>
00882     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a32">setTimedLogMode</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00899     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a33">setEventTriggeredLogMode</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00916     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a34">getLogVariableHandle</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName);
00934     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a35">startLogging</a> (<font class="keywordtype">int</font> logVariableHandle);
00948     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a36">stopLogging</a> (<font class="keywordtype">int</font> logVariableHandle);
00963     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a37">setLogDuration</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName, <font class="keywordtype">double</font> logDuration);
00976     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a38">setLogFrequency</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName, <font class="keywordtype">double</font> logFrequency);
00989     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a39">setLogStartTime</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *variableName, <font class="keywordtype">double</font> logStartTime);
01005 <font class="keyword">public</font>:
01006     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#a40">setConfigurationFileName</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *configurationFileName);
<a name="l01014"></a><a class="code" href="class_ControlProgram.html#a41">01014</a>     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a41">isControlRunning</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> d_controlRunning; }
<a name="l01020"></a><a class="code" href="class_ControlProgram.html#a42">01020</a>     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a42">isControlShuttingDown</a>()<font class="keyword"> const</font>
01021 <font class="keyword">        </font>{ <font class="keywordflow">return</font> d_communicationBlock-&gt;d_controlShuttingDown; }
<a name="l01027"></a><a class="code" href="class_ControlProgram.html#a43">01027</a>     <font class="keywordtype">int</font> <a class="code" href="class_ControlProgram.html#a43">wasShutdownAborted</a>()<font class="keyword"> const</font>
01028 <font class="keyword">        </font>{ <font class="keywordflow">return</font> d_shutdownAborted; }
01036 <font class="keyword">protected</font>:
<a name="l01037"></a><a class="code" href="class_ControlProgram.html#b8">01037</a>     <font class="keywordtype">void</font> <a class="code" href="class_ControlProgram.html#b8">shutdownComplete</a>()<font class="keyword"></font>
01038 <font class="keyword">        </font>{ d_communicationBlock-&gt;d_controlShuttingDown = 0; }
01045 <font class="keyword">public</font>:   
01046 <font class="preprocessor">    #ifndef DOXYGEN </font>
01047 <font class="preprocessor"></font>        <font class="keywordtype">double</font> getControlCycleCPUTime()<font class="keyword"></font>
01048 <font class="keyword">            </font>{ <font class="keywordflow">return</font> d_controlCycleCPUTime; }
01052 <font class="preprocessor">  #endif  </font>
01053 <font class="preprocessor"></font>    
01054 };
01055 <font class="preprocessor">#endif</font>
</font></div></pre></body>
</html>
